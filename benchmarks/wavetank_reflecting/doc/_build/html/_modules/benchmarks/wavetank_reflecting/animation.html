
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>benchmarks.wavetank_reflecting.animation &mdash; Wavetank 1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Wavetank 1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<link rel="shortcut icon" href="_static/proteusSimple.ico">
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<img src="../../../_static/proteus.png" alt="Proteus logo" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Proteus home</a>&nbsp;|&nbsp;</li>
        <li><a href="../../../api/index.html">API</a>&raquo;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for benchmarks.wavetank_reflecting.animation</h1><div class="highlight"><pre>
<span class="c"># TODO:</span>
<span class="c"># * Loop Delay is broken on GTKAgg. This is because source_remove() is not</span>
<span class="c">#   working as we want. PyGTK bug?</span>
<span class="c"># * Documentation -- this will need a new section of the User&#39;s Guide.</span>
<span class="c">#      Both for Animations and just timers.</span>
<span class="c">#   - Also need to update http://www.scipy.org/Cookbook/Matplotlib/Animations</span>
<span class="c"># * Blit</span>
<span class="c">#   * Currently broken with Qt4 for widgets that don&#39;t start on screen</span>
<span class="c">#   * Still a few edge cases that aren&#39;t working correctly</span>
<span class="c">#   * Can this integrate better with existing matplotlib animation artist flag?</span>
<span class="c">#     - If animated removes from default draw(), perhaps we could use this to</span>
<span class="c">#       simplify initial draw.</span>
<span class="c"># * Example</span>
<span class="c">#   * Frameless animation - pure procedural with no loop</span>
<span class="c">#   * Need example that uses something like inotify or subprocess</span>
<span class="c">#   * Complex syncing examples</span>
<span class="c"># * Movies</span>
<span class="c">#   * Library to make movies?</span>
<span class="c">#   * RC parameter for config?</span>
<span class="c">#   * Can blit be enabled for movies?</span>
<span class="c"># * Need to consider event sources to allow clicking through multiple figures</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="kn">import</span> <span class="n">iterable</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">verbose</span>

<div class="viewcode-block" id="Animation"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation">[docs]</a><span class="k">class</span> <span class="nc">Animation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class wraps the creation of an animation using matplotlib. It is</span>
<span class="sd">    only a base class which should be subclassed to provide needed behavior.</span>

<span class="sd">    *fig* is the figure object that is used to get draw, resize, and any</span>
<span class="sd">    other needed events.</span>

<span class="sd">    *event_source* is a class that can run a callback when desired events</span>
<span class="sd">    are generated, as well as be stopped and started. Examples include timers</span>
<span class="sd">    (see :class:`TimedAnimation`) and file system notifications.</span>

<span class="sd">    *blit* is a boolean that controls whether blitting is used to optimize</span>
<span class="sd">    drawing.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">event_source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blit</span> <span class="o">=</span> <span class="n">blit</span>

        <span class="c"># These are the basics of the animation.  The frame sequence represents</span>
        <span class="c"># information for each frame of the animation and depends on how the</span>
        <span class="c"># drawing is handled by the subclasses. The event source fires events</span>
        <span class="c"># that cause the frame sequence to be iterated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>

        <span class="c"># Clear the initial frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_draw</span><span class="p">()</span>

        <span class="c"># Instead of starting the event source now, we connect to the figure&#39;s</span>
        <span class="c"># draw_event, so that we only start once the figure has been drawn.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">)</span>

        <span class="c"># Connect to the figure&#39;s close_event so that we don&#39;t continue to</span>
        <span class="c"># fire events and try to draw to a deleted figure.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;close_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_blit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Starts interactive animation. Adds the draw frame command to the GUI</span>
<span class="sd">        handler, calls show to start the event loop.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># On start, we add our callback for stepping the animation and</span>
        <span class="c"># actually start the event_source. We also disconnect _start</span>
        <span class="c"># from the draw_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># So we can check on save</span>

    <span class="k">def</span> <span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># On stop we disconnect all of our events.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_close_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="Animation.save"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">codec</span><span class="o">=</span><span class="s">&#39;mpeg4&#39;</span><span class="p">,</span> <span class="n">clear_temp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">frame_prefix</span><span class="o">=</span><span class="s">&#39;_tmp&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Saves a movie file by drawing every frame.</span>

<span class="sd">        *filename* is the output filename, eg :file:`mymovie.mp4`</span>

<span class="sd">        *fps* is the frames per second in the movie</span>

<span class="sd">        *codec* is the codec to be used,if it is supported by the output method.</span>

<span class="sd">        *clear_temp* specifies whether the temporary image files should be</span>
<span class="sd">        deleted.</span>

<span class="sd">        *frame_prefix* gives the prefix that should be used for individual</span>
<span class="sd">        image files.  This prefix will have a frame number (i.e. 0001) appended</span>
<span class="sd">        when saving individual frames.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># Need to disconnect the first draw callback, since we&#39;ll be doing</span>
        <span class="c"># draws. Otherwise, we&#39;ll end up starting the animation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span><span class="p">)</span>
            <span class="n">reconnect_first_draw</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reconnect_first_draw</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">fnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Create a new sequence of frames for saved data. This is different</span>
        <span class="c"># from new_frame_seq() to give the ability to save &#39;live&#39; generated</span>
        <span class="c"># frame information to be saved later.</span>
        <span class="c"># TODO: Right now, after closing the figure, saving a movie won&#39;t</span>
        <span class="c"># work since GUI widgets are gone. Either need to remove extra code</span>
        <span class="c"># to allow for this non-existant use case or find a way to make it work.</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_saved_frame_seq</span><span class="p">()):</span>
            <span class="c">#TODO: Need to see if turning off blit is really necessary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_next_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%04d</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">frame_prefix</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">fnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">verbose</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s">&#39;Animation.save: saved frame </span><span class="si">%d</span><span class="s"> to fname=</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;debug&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_make_movie</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">frame_prefix</span><span class="p">)</span>

        <span class="c">#Delete temporary files</span>
        <span class="k">if</span> <span class="n">clear_temp</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="n">verbose</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s">&#39;Animation.save: clearing temporary fnames=</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">fnames</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;debug&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="c"># Reconnect signal for first draw if necessary</span>
        <span class="k">if</span> <span class="n">reconnect_first_draw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_first_draw_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;draw_event&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Animation.ffmpeg_cmd"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation.ffmpeg_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">ffmpeg_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">frame_prefix</span><span class="p">):</span>
        <span class="c"># Returns the command line parameters for subprocess to use</span>
        <span class="c"># ffmpeg to create a movie</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;ffmpeg&#39;</span><span class="p">,</span> <span class="s">&#39;-y&#39;</span><span class="p">,</span> <span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fps</span><span class="p">),</span> <span class="s">&#39;-b&#39;</span><span class="p">,</span> <span class="s">&#39;1800k&#39;</span><span class="p">,</span> <span class="s">&#39;-i&#39;</span><span class="p">,</span>
            <span class="s">&#39;</span><span class="si">%s%%</span><span class="s">04d.png&#39;</span> <span class="o">%</span> <span class="n">frame_prefix</span><span class="p">,</span> <span class="n">fname</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Animation.mencoder_cmd"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation.mencoder_cmd">[docs]</a>    <span class="k">def</span> <span class="nf">mencoder_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">frame_prefix</span><span class="p">):</span>
        <span class="c"># Returns the command line parameters for subprocess to use</span>
        <span class="c"># mencoder to create a movie</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;mencoder&#39;</span><span class="p">,</span> <span class="s">&#39;mf://</span><span class="si">%s</span><span class="s">*.png&#39;</span> <span class="o">%</span> <span class="n">frame_prefix</span><span class="p">,</span> <span class="s">&#39;-mf&#39;</span><span class="p">,</span>
            <span class="s">&#39;type=png:fps=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fps</span><span class="p">,</span> <span class="s">&#39;-ovc&#39;</span><span class="p">,</span> <span class="s">&#39;lavc&#39;</span><span class="p">,</span> <span class="s">&#39;-lavcopts&#39;</span><span class="p">,</span>
            <span class="s">&#39;vcodec=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">codec</span><span class="p">,</span> <span class="s">&#39;-oac&#39;</span><span class="p">,</span> <span class="s">&#39;copy&#39;</span><span class="p">,</span> <span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">_make_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">frame_prefix</span><span class="p">,</span> <span class="n">cmd_gen</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Uses subprocess to call the program for assembling frames into a</span>
        <span class="c"># movie file.  *cmd_gen* is a callable that generates the sequence</span>
        <span class="c"># of command line arguments from a few configuration options.</span>
        <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
        <span class="k">if</span> <span class="n">cmd_gen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cmd_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffmpeg_cmd</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">cmd_gen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">frame_prefix</span><span class="p">)</span>
        <span class="n">verbose</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s">&#39;Animation._make_movie running command: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Handler for getting events. By default, gets the next frame in the</span>
<span class="sd">        sequence and hands the data off to be drawn.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># Returns True to indicate that the event source should continue to</span>
        <span class="c"># call _step, until the frame sequence reaches the end of iteration,</span>
        <span class="c"># at which point False will be returned.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">framedata</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_seq</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_next_frame</span><span class="p">(</span><span class="n">framedata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="Animation.new_frame_seq"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation.new_frame_seq">[docs]</a>    <span class="k">def</span> <span class="nf">new_frame_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Creates a new sequence of frame information.&#39;</span>
        <span class="c"># Default implementation is just an iterator over self._framedata</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_framedata</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Animation.new_saved_frame_seq"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.Animation.new_saved_frame_seq">[docs]</a>    <span class="k">def</span> <span class="nf">new_saved_frame_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Creates a new sequence of saved/cached frame information.&#39;</span>
        <span class="c"># Default is the same as the regular frame sequence</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_draw_next_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">):</span>
        <span class="c"># Breaks down the drawing of the next frame into steps of pre- and</span>
        <span class="c"># post- draw, as well as the drawing of the frame itself.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_draw</span><span class="p">(</span><span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_frame</span><span class="p">(</span><span class="n">framedata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_draw</span><span class="p">(</span><span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initial draw to clear the frame. Also used by the blitting code</span>
        <span class="c"># when a clean base is required.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_pre_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">):</span>
        <span class="c"># Perform any cleaning or whatnot before the drawing of the frame.</span>
        <span class="c"># This default implementation allows blit to clear the frame.</span>
        <span class="k">if</span> <span class="n">blit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blit_clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit_cache</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">):</span>
        <span class="c"># Performs actual drawing of the frame.</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Needs to be implemented by subclasses to&#39;</span>
            <span class="s">&#39; actually make an animation.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_post_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">):</span>
        <span class="c"># After the frame is rendered, this handles the actual flushing of</span>
        <span class="c"># the draw, which can be a direct draw_idle() or make use of the</span>
        <span class="c"># blitting.</span>
        <span class="k">if</span> <span class="n">blit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blit_draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit_cache</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="c"># The rest of the code in this class is to facilitate easy blitting</span>
    <span class="k">def</span> <span class="nf">_blit_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="n">bg_cache</span><span class="p">):</span>
        <span class="c"># Handles blitted drawing, which renders only the artists given instead</span>
        <span class="c"># of the entire figure.</span>
        <span class="n">updated_ax</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
            <span class="c"># If we haven&#39;t cached the background for this axes object, do</span>
            <span class="c"># so now. This might not always be reliable, but it&#39;s an attempt</span>
            <span class="c"># to automate the process.</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bg_cache</span><span class="p">:</span>
                <span class="n">bg_cache</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">updated_ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="c"># After rendering all the needed artists, blit each axes individually.</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">updated_ax</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_blit_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="n">bg_cache</span><span class="p">):</span>
        <span class="c"># Get a list of the axes that need clearing from the artists that</span>
        <span class="c"># have been drawn. Grab the appropriate saved background from the</span>
        <span class="c"># cache and restore.</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">axes</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="n">bg_cache</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_setup_blit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Setting up the blit requires: a cache of the background for the</span>
        <span class="c"># axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blit_cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;resize_event&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_resize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_draw</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># On resize, we need to disable the resize event handling so we don&#39;t</span>
        <span class="c"># get too many events. Also stop the animation events, so that</span>
        <span class="c"># we&#39;re paused. Reset the cache and re-init. Set up an event handler</span>
        <span class="c"># to catch once the draw has actually taken place.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blit_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_redraw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_end_redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="c"># Now that the redraw has happened, do the post draw flushing and</span>
        <span class="c"># blit handling. Then re-enable all of the original events.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_draw</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;resize_event&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_resize</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TimedAnimation"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.TimedAnimation">[docs]</a><span class="k">class</span> <span class="nc">TimedAnimation</span><span class="p">(</span><span class="n">Animation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :class:`Animation` subclass that supports time-based animation, drawing</span>
<span class="sd">    a new frame every *interval* milliseconds.</span>

<span class="sd">    *repeat* controls whether the animation should repeat when the sequence</span>
<span class="sd">    of frames is completed.</span>

<span class="sd">    *repeat_delay* optionally adds a delay in milliseconds before repeating</span>
<span class="sd">    the animation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">repeat_delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">event_source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Store the timing information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_delay</span> <span class="o">=</span> <span class="n">repeat_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="n">repeat</span>

        <span class="c"># If we&#39;re not given an event source, create a new timer. This permits</span>
        <span class="c"># sharing timers between animation objects for syncing animations.</span>
        <span class="k">if</span> <span class="n">event_source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event_source</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">new_timer</span><span class="p">()</span>
            <span class="n">event_source</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span>

        <span class="n">Animation</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">event_source</span><span class="o">=</span><span class="n">event_source</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Handler for getting events.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># Extends the _step() method for the Animation class.  If</span>
        <span class="c"># Animation._step signals that it reached the end and we want to repeat,</span>
        <span class="c"># we refresh the frame sequence and return True. If _repeat_delay is</span>
        <span class="c"># set, change the event_source&#39;s interval to our loop delay and set the</span>
        <span class="c"># callback to one which will then set the interval back.</span>
        <span class="n">still_going</span> <span class="o">=</span> <span class="n">Animation</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">still_going</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_delay</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_delay</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeat_delay</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">still_going</span>

    <span class="k">def</span> <span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># If we stop in the middle of a loop delay (which is relatively likely</span>
        <span class="c"># given the potential pause here, remove the loop_delay callback as</span>
        <span class="c"># well.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_delay</span><span class="p">)</span>
        <span class="n">Animation</span><span class="o">.</span><span class="n">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_loop_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># Reset the interval and change callbacks after the delay.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop_delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ArtistAnimation"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.ArtistAnimation">[docs]</a><span class="k">class</span> <span class="nc">ArtistAnimation</span><span class="p">(</span><span class="n">TimedAnimation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Before calling this function, all plotting should have taken place</span>
<span class="sd">    and the relevant artists saved.</span>

<span class="sd">    frame_info is a list, with each list entry a collection of artists that</span>
<span class="sd">    represent what needs to be enabled on each frame. These will be disabled</span>
<span class="sd">    for other frames.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Internal list of artists drawn in the most recent frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Use the list of artists as the framedata, which will be iterated</span>
        <span class="c"># over by the machinery.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_framedata</span> <span class="o">=</span> <span class="n">artists</span>
        <span class="n">TimedAnimation</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Make all the artists involved in *any* frame invisible</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="c"># Assemble a list of unique axes that need flushing</span>
                <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">axes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="c"># Flush the needed axes</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_pre_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">,</span> <span class="n">blit</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clears artists from the last frame.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">blit</span><span class="p">:</span>
            <span class="c"># Let blit handle clearing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blit_clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blit_cache</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Otherwise, make all the artists from the previous frame invisible</span>
            <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span><span class="p">:</span>
                <span class="n">artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">):</span>
        <span class="c"># Save the artists that were passed in as framedata for the other</span>
        <span class="c"># steps (esp. blitting) to use.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span> <span class="o">=</span> <span class="n">artists</span>

        <span class="c"># Make all the artists from the current frame visible</span>
        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FuncAnimation"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.FuncAnimation">[docs]</a><span class="k">class</span> <span class="nc">FuncAnimation</span><span class="p">(</span><span class="n">TimedAnimation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Makes an animation by repeatedly calling a function *func*, passing in</span>
<span class="sd">    (optional) arguments in *fargs*.</span>

<span class="sd">    *frames* can be a generator, an iterable, or a number of frames.</span>

<span class="sd">    *init_func* is a function used to draw a clear frame. If not given, the</span>
<span class="sd">    results of drawing from the first item in the frames sequence will be</span>
<span class="sd">    used.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="bp">None</span> <span class="p">,</span><span class="n">init_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">save_count</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">fargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>

        <span class="c"># Amount of framedata to keep around for saving movies. This is only</span>
        <span class="c"># used if we don&#39;t know how many frames there will be: in the case</span>
        <span class="c"># of no generator or in the case of a callable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span> <span class="o">=</span> <span class="n">save_count</span>

        <span class="c"># Set up a function that creates a new iterable when needed. If nothing</span>
        <span class="c"># is passed in for frames, just use itertools.count, which will just</span>
        <span class="c"># keep counting from 0. A callable passed in for frames is assumed to</span>
        <span class="c"># be a generator. An iterable will be used as is, and anything else</span>
        <span class="c"># will be treated as a number of frames.</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter_gen</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter_gen</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="k">elif</span> <span class="n">iterable</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter_gen</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">iter</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iter_gen</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span> <span class="o">=</span> <span class="n">frames</span>

        <span class="c"># If we&#39;re passed in and using the default, set it to 100.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_func</span> <span class="o">=</span> <span class="n">init_func</span>

        <span class="c"># Needs to be initialized so the draw functions work without checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">TimedAnimation</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># Need to reset the saved seq, since right now it will contain data</span>
        <span class="c"># for a single frame from init, which is not what we want.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="FuncAnimation.new_frame_seq"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.FuncAnimation.new_frame_seq">[docs]</a>    <span class="k">def</span> <span class="nf">new_frame_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Use the generating function to generate a new frame sequence</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_gen</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="FuncAnimation.new_saved_frame_seq"><a class="viewcode-back" href="../../../api/benchmarks.wavetank_reflecting.html#benchmarks.wavetank_reflecting.animation.FuncAnimation.new_saved_frame_seq">[docs]</a>    <span class="k">def</span> <span class="nf">new_saved_frame_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Generate an iterator for the sequence of saved data. If there are</span>
        <span class="c"># no saved frames, generate a new frame sequence and take the first</span>
        <span class="c"># save_count entries in it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_count</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_init_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Initialize the drawing either using the given init_func or by</span>
        <span class="c"># calling the draw function with the first item of the frame sequence.</span>
        <span class="c"># For blitting, the init_func should return a sequence of modified</span>
        <span class="c"># artists.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_frame</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_frame_seq</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_func</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_draw_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">framedata</span><span class="p">):</span>
        <span class="c"># Save the data for potential saving of movies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">framedata</span><span class="p">)</span>

        <span class="c"># Make sure to respect save_count (keep only the last save_count around)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_seq</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">save_count</span><span class="p">:]</span>

        <span class="c"># Call the func with framedata and args. If blitting is desired,</span>
        <span class="c"># func needs to return a sequence of any artists that were modified.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawn_artists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="n">framedata</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Proteus home</a>&nbsp;|&nbsp;</li>
        <li><a href="../../../api/index.html">API</a>&raquo;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Matt Malej, Chris Kees.
    </div>
  </body>
</html>